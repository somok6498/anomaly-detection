spring:
  application:
    name: anomaly-detection

server:
  port: 8080

# Aerospike connection
aerospike:
  host: 127.0.0.1
  port: 3000
  namespace: banking

# Risk scoring configuration
risk:
  # Composite score threshold for ALERT action (score >= this but < blockThreshold)
  alert-threshold: 30.0
  # Composite score threshold for BLOCK action (score >= this)
  block-threshold: 70.0
  # EWMA smoothing factor. Lower = slower adaptation to new patterns.
  # 0.01 is good for 30-day windows with high txn volume.
  ewma-alpha: 0.01
  # Minimum transactions before rules apply to a client (grace period for new clients)
  min-profile-txns: 20
  # How often (seconds) to reload rules from Aerospike into memory cache
  rule-cache-refresh-seconds: 60

  # Configurable transaction types — add new types (e.g., CBDC) here without code changes
  transaction-types:
    - NEFT
    - RTGS
    - IMPS
    - UPI
    - IFT

  # Rule default parameters — fallback values when not specified in rule.params (Aerospike).
  # Override per-rule via PUT /api/v1/rules/{ruleId} or seed via DataSeeder.
  rule-defaults:
    # Existing rules
    amount-anomaly-variance-pct: 100.0
    amount-per-type-variance-pct: 150.0
    min-type-samples: 10
    hourly-amount-variance-pct: 80.0
    tps-spike-variance-pct: 50.0
    min-type-frequency-pct: 5.0
    min-repeat-count: 5
    beneficiary-concentration-variance-pct: 200.0
    min-distinct-beneficiaries: 5
    abs-min-concentration-pct: 5.0
    min-beneficiary-txns: 3
    max-cv-pct: 10.0
    isolation-forest-threshold: 60.0
    # New rules
    daily-cumulative-variance-pct: 150.0
    daily-cumulative-min-days: 3
    new-bene-max-per-day: 5
    new-bene-variance-pct: 200.0
    new-bene-min-profile-days: 3
    dormancy-days: 30
    cross-channel-bene-variance-pct: 150.0
    cross-channel-bene-min-days: 3

# Swagger / OpenAPI
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: method
  api-docs:
    path: /v3/api-docs

# Twilio notification (SMS / WhatsApp) on BLOCKED transactions
# Set these via environment variables: TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, etc.
twilio:
  account-sid: ${TWILIO_ACCOUNT_SID:}
  auth-token: ${TWILIO_AUTH_TOKEN:}
  from-number: ${TWILIO_FROM_NUMBER:+14155238886}
  to-number: ${TWILIO_TO_NUMBER:+919830709527}
  enabled: ${TWILIO_ENABLED:true}
  channel: ${TWILIO_CHANNEL:whatsapp}   # "sms" or "whatsapp"

# Observability: OTEL traces + Actuator metrics
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  tracing:
    sampling:
      probability: 1.0
  otlp:
    tracing:
      endpoint: http://localhost:4318/v1/traces

# Logging
logging:
  level:
    com.bank.anomaly: INFO
    com.bank.anomaly.engine: DEBUG
